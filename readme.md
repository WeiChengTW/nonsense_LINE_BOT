# LineBot 使用說明書

本 LineBot 支援多種互動與管理功能，適合群組及個人聊天使用。以下為詳細使用說明，包含所有指令與操作方式。

---

## 功能列表與指令說明

| 指令              | 功能說明                                      |
| ----------------- | --------------------------------------------- |
| 設定設定          | 查詢/切換 bot 模式（亂說話/乖寶寶/靜音/聊天） |
| 你現在是甚麼模式  | 查詢目前 bot 的運作模式（聊天/靜音/亂說話）   |
| 閉嘴              | bot 進入靜音模式，不再回覆訊息                |
| 聊天              | bot 解除靜音，恢復回覆訊息                    |
| 亂說話模式        | 啟用跨聊天室學習與回覆（狂暴模式）            |
| 乖寶寶模式        | 關閉亂說話模式，僅在本聊天室學習與回覆        |
| 學 A B            | 教 bot 收到「A」時回覆「B」                   |
| 你會說什麼        | 查詢本聊天室已教過 bot 的內容                 |
| 壞壞              | 刪除 bot 上次學到的內容                       |
| 黃心如怎麼說      | 隨機回覆老師語錄（需預先設定資料）            |
| 統計資料          | 查詢個人訊息/貼圖/圖片/文件/連結等統計        |
| 全部統計          | 查詢總訊息、貼圖、連結、圖片、文件等統計      |
| 訊息統計          | 查詢訊息發送次數                              |
| 貼圖統計          | 查詢貼圖發送次數                              |
| 每小時統計        | 查詢一天內各小時的發言分布                    |
| 連結統計          | 查詢連結發送次數                              |
| 圖片統計          | 查詢圖片發送次數                              |
| 文件統計          | 查詢文件發送次數                              |
| 我的口頭禪 [年份] | 查詢自己常用詞排行（可指定年份）              |
| 排行榜            | 查詢群組發言排行榜（僅限群組）                |

---

## 指令詳解

### 查詢/切換模式

- `設定設定`：查詢目前 bot 模式（亂說話/乖寶寶）與狀態（靜音/聊天），可點選 quick reply 切換。
- `你現在是甚麼模式`、`你現在是什麼模式`、`你現在什麼模式`：查詢 bot 是否在靜音或亂說話模式。

### 靜音/恢復聊天

- `閉嘴`：bot 進入靜音模式，暫停回覆。
- `聊天`：解除靜音，恢復正常回覆。

### 亂說話/乖寶寶模式

- `亂說話模式`：開啟後，bot 會跨聊天室學習與回覆（即所有群組共享學習內容）。
- `乖寶寶模式`：關閉亂說話模式，僅在本聊天室學習與回覆。

### 教學功能

- `學 A B`：教 bot 當收到「A」時，回覆「B」。  
   例如：「學 早安 早安你好」。
- `你會說什麼`：查詢本聊天室已教過 bot 的所有內容。

### 刪除學習內容

- `壞壞`：刪除 bot 上次回覆的學習內容，並回覆「下次不說 XXX 了」。

### 老師語錄

- `黃心如怎麼說`：隨機回覆預設的老師語錄（需於 `teacher.json` 設定語錄內容）。

### 統計資料與排行

- `統計資料`：顯示 quick reply，查詢全部統計、訊息統計、貼圖統計、每小時統計、連結統計、圖片統計、文件統計、我的口頭禪等。
- `全部統計`：查詢總訊息、貼圖、連結、圖片、文件等統計。
- `訊息統計`：查詢訊息發送次數。
- `貼圖統計`：查詢貼圖發送次數。
- `每小時統計`：查詢一天內各小時的發言分布。
- `連結統計`：查詢連結發送次數。
- `圖片統計`：查詢圖片發送次數。
- `文件統計`：查詢文件發送次數。
- `我的口頭禪 [年份]`：查詢自己常用詞排行（可加年份）。
- `排行榜`：查詢群組發言排行榜（僅限群組）。

---

## 特殊行為說明

- **重複訊息回覆**：同一群組內有多人同時說出相同訊息時，bot 會回覆該訊息，並清空該群組所有人的紀錄，避免洗版。
- **查詢內容**：在「亂說話模式」下，查詢會跨聊天室；在「乖寶寶模式」下，僅查詢本聊天室。
- **統計 quick reply**：輸入「統計資料」會顯示多種 quick reply 按鈕，方便查詢各類統計。

---

## 部署與運行

1. **安裝依賴：**
   ```bash
   pip install flask line-bot-sdk jieba
   ```
2. **設定 LINE Channel Access Token 與 Secret，並於程式碼中填寫。**
3. **啟動伺服器：**
   ```bash
   python linebotserver.py
   ```
4. **設定 Webhook 至 `/callback` 路徑。**

---

## 檔案說明

- `data.json`：儲存學習內容
- `silent_mode.json`：儲存靜音狀態
- `rage_mode.json`：儲存亂說話模式狀態
- `user_last_message.json`：記錄用戶最後訊息
- `last_reply.json`：記錄上次回覆內容
- `teacher.json`：老師語錄資料（選用）
- `user_message_stats.json`：用戶訊息/貼圖/圖片/文件/連結等統計
- `user_messages.json`：用戶訊息內容（用於口頭禪排行）

---

## 更新紀錄

### 2024-06-13

- 新增「我的口頭禪」指令可查詢今年或指定年份的口頭禪排行
- 統計資料支援查詢：全部統計、訊息統計、貼圖統計、每小時統計、連結統計、圖片統計、文件統計
- 支援多種統計 quick reply
- 修正部分指令重複顯示問題
- 其他細部優化

---

## 常見問題

- **格式錯誤**：「學」指令需為「學 A B」格式，否則會提示錯誤。
- **未設定語錄**：「黃心如怎麼說」若未設定語錄，會回覆「老師今天沒話說～」。
